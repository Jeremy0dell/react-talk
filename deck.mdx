import { Head } from 'mdx-deck'
import { Appear } from 'mdx-deck'

import 'style-loader!css-loader!codemirror/lib/codemirror.css'
import 'style-loader!css-loader!./cm-night-owl.css'
import 'style-loader!css-loader!./styles.css'
import 'codemirror/mode/javascript/javascript'
import 'codemirror/mode/jsx/jsx'
import {CodeBlock} from './JS/code-block'
import Logger from './JS/logger'
import MyComponent, {SecondComponent} from './JS/MyComponent'
import { Split } from 'mdx-deck/layouts'

export {default as theme} from './theme'

Hi, my name is Jeremy and I'm a little nervous

Anyways, let's talk about React

---

## What is React?
<Appear>
<div><div style={{ marginTop: 80 }}>React is a DOM manipulation library developed by Facebook</div></div>
<div><div style={{ marginTop: 80 }}>React is being able to intersperse JS, HTML, and CSS seamlessly</div></div>
<CodeBlock>{`function Component {
  return <div>{Math.random() > 0.5 ? 'Over' : 'Under'}</div>
}`}</CodeBlock>
<div><div style={{ marginTop: 15 }}>React is as simple or as complex as you want to make it</div></div>
<div><div style={{ marginTop: 80 }}>React is permanent job security for the rest of eternity</div></div>
</Appear>

```notes
- 1. Not really much to say about this. React was initially released by Facebook five years ago and has since taken the web dev community by storm. It's MIT licensed and maintained by React engineers and the community at large
- 2. React makes use of a great markup-like syntax called JSX. Although not required, this is part of the beauty of React code. It's a little hard to explain, so here is an example.
- 3. React is really good at being declarative and being composable. Because of this, components can be put to many novel uses and components can be infinitely nested within eachother. In this talk I'm going to go over a few of the hottest react design patterns so hopefully you can see this demonstrated a bit later
- 4. React has had a meteoric rise since it's conception and it keeps getting more and more popular. Job listings, library downloads, and github stars are getting higher and higher every year. I know that many schools including dartmouth are teaching web dev classes in React and many into to programming courses are taught in javascript. There are many reasons for this, but it's pervasivness is undeniable.
```
---
<div>
<Appear>
<div><div style={{ fontSize: 30, marginBottom: 50}}>Why React?</div></div>

<div style={{ fontSize: 30 }}>
  <div style={{ display: 'flex', flexDirection: 'space-between' }}>
  <CodeBlock>{`<ul
  class="error-messages"
  *ngIf="errorList">
  <li *ngFor="let error of errorList">
    {{ error }}
  </li>
</ul>`}</CodeBlock>

  <CodeBlock>{`errorList ?
  <ul className="error-messages">
    {errorList.map(error =>
      <li key={error.key}>
        {error}
      </li)}
  </ul> :
  // Something else
`}</CodeBlock>
  </div>
</div>
<div><div>
  <CodeBlock>{`// Imports at top of the file
const PaddedContainer = styled(Container)\`
  padding-top: 30px;
  padding-bottom: 30px;
\`\n
<DataProvider>
  {({ data, user }) => <PaddedContainer>
    <Nav user={user.name}/>
    <Dashboard dataProp={...data}/>
    <Footer />
  </PaddedContainer>}
</DataProvider>`}</CodeBlock>
</div></div>
</Appear>
</div>

```notes
- On the left we have a tiny piece of a template you would see in angular, and on the right some React code. First of all, this is a code example of using JSX. Between the <ul> tags we have some javascript that maps through errorList and renders list elements.
- I find this to be more declarative than the angular version, because it describes the flow, more than it does explicitly say what we want to happen. Riff about angular sucking
- React is Declarative
- React is infinitely modular and creating modular components is very easy
- Explain the block of code. The styled() function adds styles to the Container component, the DataProvider allows us to render jsx with some state, the inner components make use of those props. again, this demonstrates
```
---
A quick note about the nature of Javascript
<Appear>
<CodeBlock>{`function giveMeAFunctionThatBeepsANumber(x){
  return function (y) {
    alert('Beep ' + (x + y));
  }
}\n
var beeper = giveMeAFunctionThatBeeps(2)\n
<button onClick={() => beeper(10)}>Click me!</button>
`}</CodeBlock>
<div><button style={{ height: 30 }} onClick={() => alert(12)}>Click me!</button></div>
<CodeBlock>{`var curry = (fn,arity = fn.length,nextCurried) =>
  (nextCurried = prevArgs =>
    nextArg => {
      var args = [ ...prevArgs, nextArg ];\n
      if (args.length >= arity) {
        return fn( ...args );
      }
      else {
        return nextCurried( args );
      }
    }
  )( [] );`}</CodeBlock>
</Appear>
---

## React Basics
<Appear>
<img style={{ height: 300 }}
src="https://i.imgflip.com/2j1bos.jpg"
/>
Also Props
<div><div style={{ display: 'flex', justifyContent: 'space-between' }}>
  <CodeBlock>{`function ES5Component(props) {
  return (
    <div style={props.styles}>
      <Content data={props.data} />
      <Toolbar currUser={props.user} />
    </div>
  )
}`}</CodeBlock>
  <CodeBlock>{`const ES6Component = ({ styles, data, user }) =>
  <div style={styles}>
    <Content data={data} />
    <Toolbar currUser={user} />
  </div>`}</CodeBlock>
</div></div>
</Appear>

####
```notes
- You've already seen a little bit of this, BUT  -> Conceptually, components are like JavaScript functions. They accept arbitrary inputs (called ‚Äúprops‚Äù) and return a special kind of markup called JSX which is a powerful tool, combining HTML and Javascript to describe what should show up on a page
--
```
---

### Types of Components
<div>
  <Appear>
  <div><div style={{ display: 'flex', justifyContent: 'space-around' }}>
    <div>Functional</div>
    <div>Stateful</div>
  </div></div>
  <div><div style={{ display: 'flex', justifyContent: 'space-between' }}>
    <div><CodeBlock>{` const MyComponent = props =>

  <div style={props.styles}>
    <Title value={props.title} />
    <div style={{ padding: 10 }}>
      My name is: {props.name}
    </div>
    <StyledButton
      text="Submit"
      onClick={() => props.handleSubmit(props.name)}
    />
    <StyledButton
      text="Exit"
      onClick={props.handleExitClick}
    />
  </div>
`}</CodeBlock></div>
  <CodeBlock>{`class StateComponent extends React.Component {
  state = {
    nameForm: '',
    counter: 0,
    todos: {}
  }\n
  componentDidMount() {
    fetch(\`https://my-remote-endpoint.biz/todos/\${localStorage.name}\`)
      .then(res => this.setState({ todos: res.data.todos }))
  }\n
  updateCounter = () => {
    this.setState({ counter: this.state.counter + 1 })
  }
  updateName = e => {
    this.setState({ nameForm: e.target.value })
  }\n
  render() {
    return (
      // JSX code goes here
      // I just don't want to take up too much space on the page
    )
  }
}`}</CodeBlock>
  </div></div>
  </Appear>
</div>

---

<CodeBlock style={{ fontSize: 20 }}>{`const Accordion = ({items, ...props}) =>
  <BaseAccordion {...props}>
    {({openIndexes, handleItemClick}) => (
      <div>
        {items.map((item, index) => (
          <AccordionItem key={item.title} direction="vertical">
            <AccordionButton
              isOpen={openIndexes.includes(index)}
              onClick={() => handleItemClick(index)}
            >
              {item.title}{' '}
              <span>{openIndexes.includes(index) ? 'üëá' : 'üëà'}</span>
            </AccordionButton>
            <AccordionContents isOpen={openIndexes.includes(index)}>
              {item.contents}
            </AccordionContents>
          </AccordionItem>
        ))}
      </div>
    )}
  </BaseAccordion>`}</CodeBlock>

---

## Let's take a look at some basic React
## Code ‚Üì ------------- Render ‚Üì
<div style={{ display: 'flex', justifyContent: 'space-between' }}>
  <CodeBlock>
  {`<CodeBlock style={{
    fontSize: 26,
    fontStyle: 'oblique'
  }}>
  {\`<h1>My code goes here!</h1>\`}
</CodeBlock>`}
</CodeBlock>

<CodeBlock style={{ marginTop: 26, fontSize: 26, fontStyle: 'oblique' }}>{`<h1>My code goes here!</h1>`}</CodeBlock>

</div>


<Appear>
Now let's look at the CodeBlock Component
<CodeBlock>{`import React from 'react'
import {UnControlled as CodeMirror} from 'react-codemirror2'
\nexport const CodeBlock = ({children, options = {}, style, ...props}) => (
  <div style={{fontSize: 18, overflow: 'scroll', ...style}}>
    <CodeMirror
      value={children}
      options={{
        mode: 'jsx',
        theme: 'night-owl',
        lineNumbers: false,
        readOnly: 'nocursor',
        ...options,
      }}
      {...props}
    />
  </div>
)`}</CodeBlock>
</Appear>

```notes
- Create speaker notes in fenced code blocks
```

---

Higher-Order Components

<Appear>
<CodeBlock>
  {`const MyStyledComponent = HOCforStyling(MyBoringComponent)
const MyStyledAsyncComponent = HOCforAsync(MyStyledComponent)`}
</CodeBlock>
OR
<CodeBlock>
{`const MyStyledAsyncComponent = HOCforAsync(HOCforStyling(MyBoringComponent))`}</CodeBlock>
OR
<CodeBlock>{`
const makeStyledAndAsyc = compose(
  HOCforAsync,
  HOCforStyling
)
const MyStyledAsyncComponent = makeStyledAndAsyc(MyBoringComponent)`}
</CodeBlock>


</Appear>

```notes
- This is a function that wraps a component and returns a new component
```

---

<CodeBlock>{`function someHOC(WrappedComponent) {
  return class extends React.Component {
    state = {
      // Do you want your HOC to enhance a component with state?
    }\n
    componentDidMount() { // How about a lifecycle method? }\n
    someMethod = () => // or pass down a method?\n
    render() {
      return (
        <WrappedComponent
          extraState={this.state}
          extraMethod={this.someMethod}
          {...props} // to pass down props from other composed Components
        />
      )
    }
  }
}\n\n
const EnhancedComponent = someHOC(BoringComponent)`}</CodeBlock>

---

## Render props
### Revenge of the Bearded Hipsters

---
export default Split

<div><div style={{ fontSize: 46 }}>
  The "Perils" of HOCS
  <CodeBlock>{`export default compose(
  withRouter,
  formData({
    product: 0,
    recipientType: 'Manufacturer',
    email: '', itemsSelected: []
  }),
  getProducts,
  connect(null, { removeItemFromState }),
)(ManufacturerTransfer)`}</CodeBlock>
</div></div>

<CodeBlock options={{ lineNumbers: true }} style={{ fontSize: 18 }}>{`const ManufacturerTransfer = ({
  user, history, form, // üò°üò°üò° THIS IS HEINOUS üò°üò°üò°
  updateState, products, handleChange,
  handleProductDropdown, handleCheckboxEvent, removeItemFromState,
}) =>
  <div>
    <Button />
    <div style={styles.transferContainer}>
      <div style={styles.boxShadowTransfer}>
        <div style={styles.transferTitle}>Transfer Solerus Certificates</div>
        <Dropdown form={form} products={products} handleProductDropdown={handleProductDropdown} />
        <Table
          user={user}
          selectedProduct={form.product}
          itemsSelected={form.itemsSelected}
          products={products.list}
          handleCheckboxEvent={handleCheckboxEvent}
        />
        <Input
          form={form}
          updateState={updateState}
          handleChange={handleChange}
        />
        <div // eslint-disable-line
          style={body.transferForm}
          onClick={() => {
            const submitObj = {
              user, // Wait, where does user come from???
              type: form.recipientType,
              items: user.ownership.filter(item => item.product === products.list[form.product]._id)
              .filter((item, idx) => includes(form.itemsSelected, idx)),
              email: form.email,
            }
            axios.post(\`/manu\${MANUFACTURER_TRANSFER}\`, submitObj)
            .then((res) => {
              res.data.items.forEach(itm => removeItemFromState(itm._id))
              history.push('/manufacturer')
            })
          }}
        />
      </div>
    </div>
  </div>`}</CodeBlock>

---

<CodeBlock style={{ fontSize: 30 }}>{`const MyComponent = ({ children }) =>
  <React.Fragment>
    { console.log(children) }
  </React.Fragment>\n
<MyComponent>
  <div>This is MyComponent's first child</div>
  <div>This is MyComponent's second child</div>
</MyComponent>`}</CodeBlock>

<MyComponent>
  <div>This is MyComponent's first child</div>
  <div>This is MyComponent's second child</div>
</MyComponent>
---

<CodeBlock>{`const ProviderComponent = ({ render }) => render({
    name: 'Jeremy',
    company: 'Slalom',
    rating: 10
  })\n
<ProviderComponent render={({name, company, rating}) =>
  <div>
    My name is {name} and I would rate {company} as a {rating} out of 10
  </div>}
/>`}</CodeBlock>
<Appear>
<div>Renders:</div>
<div>My name is Jeremy and I would rate Slalom as a 10 out of 10</div>
</Appear>

---
<div><div style={{ fontSize: 40 }}>Do render props cause callback hell?</div></div>
<Appear>
<CodeBlock>{`const verifyUser = function(username, password, callback){
   dataBase.verifyUser(username, password, (error, userInfo) => {
       if (error) {
           callback(error)
       } else {
           dataBase.getRoles(username, (error, roles) => {
               if (error) {
                   callback(error)
               } else {
                   dataBase.logAccess(username, (error) => {
                       if (error) {
                           callback(error);
                       } else {
                           callback(null, userInfo, roles);
                       }
                   })
               }
           })
       }
   })
};`}</CodeBlock>
<CodeBlock>{`<ProviderComponent render={({name, company, rating}) =>
  <SecondProviderComponent render={({ someMethod, someObject }) =>
    <ThirdProviderComponent render={({ bottomText }) =>
      <div>
        My name is {name} and I would rate {company} as a {rating} out of 10
        <button onClick={someMethod} />
        <Text value={bottomText} />
      </div>
    } />
  } />
} />`}</CodeBlock>
<div><div style={{ fontSize: 40 }}>So basically yes, they can</div></div>
</Appear>
